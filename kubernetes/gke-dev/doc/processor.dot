digraph {
    edge [penwidth=3.0];
    compound=true;

    subgraph cluster_ingress {
        label="ingress";

        chqdecorator [style=filled,fillcolor="#ddf"];
        partition_exporter [style=filled,fillcolor="#ddf"];

        subgraph {
            edge [color=red];
            LOGS -> "memory_limiter/ingress";
            "memory_limiter/ingress" -> "chqdecorator";
            "chqdecorator" -> "partition_exporter";
        }

        subgraph {
            edge [color=blue];
            METRICS -> "memory_limiter/ingress";
            "memory_limiter/ingress" -> "chqdecorator";
            "chqdecorator" -> "partition_exporter";
        }

        subgraph {
            edge [color=green];
            TRACES -> "memory_limiter/ingress";
            "memory_limiter/ingress" -> "groupbytrace";
            "groupbytrace" -> "chqdecorator";
            "chqdecorator" -> "partition_exporter";
        }
    }

    subgraph cluster_partitioned {
        label="partitioned";

        "awss3/cardinalhq" [style=filled,fillcolor="#ddf"];
        "awss3/spanmetrics" [style=filled,fillcolor="#ddf"];

        subgraph {
            edge [color=red];
            "partition_receiver" -> "batch/logs";
            "batch/logs" -> "awss3/cardinalhq";
            "batch/logs" -> "forward/filtered";
            "forward/filtered" -> "filter/chq" -> "attributes/chq";
            "attributes/chq" -> "otelhttp/cardinalhq";
        }

        subgraph {
            edge [color=blue];
            "partition_receiver" -> "batch/metrics";
            "batch/metrics" -> "awss3/cardinalhq";
            "batch/metrics" -> "forward/filtered";
            "forward/filtered" -> "filter/chq" -> "attributes/chq";
            "attributes/chq" -> "datadog/cardinalhq";
        }

        subgraph {
            edge [color=green];
            "partition_receiver" -> "batch/traces";
            "batch/traces" -> { "awss3/cardinalhq" "forward/filtered" "spanmetrics/chq" };
            "forward/filtered" -> "filter/chq" -> "attributes/chq";
            "attributes/chq" -> "datadog/cardinalhq";
            "spanmetrics/chq" -> "awss3/spanmetrics";
        }
    }

    subgraph cluster_network {
        edge [label="network",style=dotted];
        subgraph {
            edge [color=red];
            "partition_exporter" -> "partition_receiver";
        }

        subgraph {
            edge [color=blue];
            "partition_exporter" -> "partition_receiver";
        }

        subgraph {
            edge [color=green];
            "partition_exporter" -> "partition_receiver";
        }
    }
}
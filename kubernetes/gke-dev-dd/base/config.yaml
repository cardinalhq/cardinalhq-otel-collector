apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/name: cardinalhq
    app.kubernetes.io/component: collector
    app.kubernetes.io/instance: collector-gke-dev-dd
  name: cardinal-collector-config
data:
  config.yaml: |-
    receivers:
      chqdatadog:
        endpoint: 0.0.0.0:8126
    processors:
      batch:
        timeout: 10s
        send_batch_size: 100
        send_batch_max_size: 1000
      memory_limiter:
        limit_mib: 1000
        check_interval: 1s
    exporters:
      debug:
        verbosity: detailed
        sampling_initial: 10
        sampling_thereafter: 1001
      nop:
      datadog:
        api:
          key: ${env:DD_API_KEY}
          site: us3.datadoghq.com

    service:
      pipelines:
        logs:
          receivers: [chqdatadog]
          processors: [memory_limiter, batch]
          exporters: [datadog]
        metrics:
          receivers: [chqdatadog]
          processors: [memory_limiter, batch]
          exporters: [datadog]
        traces:
          receivers: [chqdatadog]
          exporters: [nop]
      extensions:
        - zpages
        - health_check

      telemetry:
        metrics:
          readers:
            - periodic:
                interval: 10000
                exporter:
                  otlp:
                    protocol: grpc/protobuf
                    endpoint: http://cardinal-collector.collector.svc.cluster.local:4317

    extensions:
      zpages:
        endpoint: "0.0.0.0:55679"
      health_check:
        endpoint: "0.0.0.0:13133"
        path: "/healthz"
